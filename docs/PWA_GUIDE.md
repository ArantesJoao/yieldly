# PWA (Progressive Web App) Guide

This document explains how Yieldly is configured as a Progressive Web App and how to use and test PWA features.

## What is a PWA?

A Progressive Web App is a web application that can be installed on devices like a native app, work offline, receive push notifications, and provide an app-like experience.

## Features Implemented

### âœ… Web App Manifest
- **File**: `/public/manifest.json`
- Defines app name, description, icons, theme colors, and display mode
- Enables "Add to Home Screen" functionality

### âœ… Service Worker
- Automatically generated by `@ducanh2912/next-pwa`
- Provides offline functionality and caching
- Only active in production builds (disabled in development)

### âœ… App Icons
- 192x192px icon for mobile devices
- 512x512px icon for high-resolution displays
- Both configured for "any" and "maskable" purposes

### âœ… Metadata & Viewport
- Proper viewport configuration for mobile devices
- Theme color for native app feel
- Apple Web App capable meta tags
- Open Graph and Twitter card support

## Configuration

### Next.js Configuration (`next.config.ts`)
```typescript
const withPWA = withPWAInit({
  dest: "public",                          // Service worker output directory
  cacheOnFrontEndNav: true,               // Cache on navigation
  aggressiveFrontEndNavCaching: true,     // Aggressive caching for better offline experience
  reloadOnOnline: true,                   // Reload when connection is restored
  swcMinify: true,                        // Minify service worker
  disable: process.env.NODE_ENV === "development",  // Disable in dev mode
  workboxOptions: {
    disableDevLogs: true,                 // Cleaner console output
  },
});
```

### App Metadata (`src/app/layout.tsx`)
- Viewport configuration with theme color
- Application name and descriptions
- Apple Web App settings
- Icon configuration
- Manifest reference

## Testing PWA Features

### Local Development
1. **Build for production**:
   ```bash
   npm run build
   npm start
   ```

2. **Access the app**:
   - Open `http://localhost:3000` in your browser
   - PWA features are only active in production builds

### Testing on Desktop (Chrome/Edge)

1. Open the app in Chrome/Edge
2. Look for the install button in the address bar
3. Click "Install" to add to your applications
4. Test offline functionality:
   - Open DevTools â†’ Application â†’ Service Workers
   - Check "Offline" mode
   - Navigate through the app

### Testing on Mobile

#### iOS (Safari)
1. Open the app in Safari
2. Tap the Share button
3. Scroll down and tap "Add to Home Screen"
4. The app will appear on your home screen like a native app

#### Android (Chrome)
1. Open the app in Chrome
2. Tap the menu (â‹®)
3. Tap "Install app" or "Add to Home Screen"
4. The app will be installed like a native app

### Lighthouse Audit
1. Open Chrome DevTools
2. Go to "Lighthouse" tab
3. Select "Progressive Web App" category
4. Click "Generate report"
5. Review PWA checklist and scores

## PWA Capabilities

### âœ… Currently Enabled
- **Installable**: Can be added to home screen
- **Offline Support**: Basic caching of static assets
- **App-like Experience**: Standalone display mode
- **Fast Loading**: Cached resources load instantly

### ðŸ”„ Can Be Added in Future
- **Push Notifications**: Notify users of important updates
- **Background Sync**: Sync data when connection is restored
- **Periodic Background Sync**: Update data periodically
- **Web Share API**: Share content from the app

## File Structure

```
yieldly/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ manifest.json              # Web app manifest
â”‚   â”œâ”€â”€ sw.js                      # Service worker (auto-generated)
â”‚   â”œâ”€â”€ workbox-*.js              # Workbox runtime (auto-generated)
â”‚   â””â”€â”€ icons/
â”‚       â”œâ”€â”€ web-app-manifest-192x192.png
â”‚       â””â”€â”€ web-app-manifest-512x512.png
â”œâ”€â”€ src/app/
â”‚   â””â”€â”€ layout.tsx                # PWA metadata configuration
â””â”€â”€ next.config.ts                # PWA build configuration
```

## Customization

### Changing Theme Color
Edit `manifest.json` and `layout.tsx`:
```json
// manifest.json
{
  "theme_color": "#your-color",
  "background_color": "#your-color"
}
```

```typescript
// layout.tsx
export const viewport: Viewport = {
  themeColor: "#your-color",
  // ...
};
```

### Updating App Name/Description
Edit `manifest.json`:
```json
{
  "name": "Your App Name",
  "short_name": "Short Name",
  "description": "Your app description"
}
```

### Adding More Icons
Add icons to `/public/icons/` and update `manifest.json`:
```json
{
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png"
    }
    // ... more icons
  ]
}
```

## Caching Strategy

The default caching strategy includes:
- **Static Assets**: HTML, CSS, JS files are cached
- **Images**: Cached on first load
- **API Calls**: Can be configured for custom caching

To customize caching, modify the `workboxOptions` in `next.config.ts`.

## Troubleshooting

### PWA not installing?
- Ensure you're using HTTPS (or localhost)
- Check browser console for errors
- Verify manifest.json is accessible
- Run Lighthouse audit to identify issues

### Service worker not updating?
- Clear browser cache
- Unregister old service workers in DevTools
- Hard refresh (Ctrl/Cmd + Shift + R)

### Icons not showing?
- Verify icon paths in manifest.json
- Check icon file sizes match specified sizes
- Ensure icons are accessible (not 404)

## Best Practices

1. **Always test in production mode** - PWA features are disabled in development
2. **Test offline scenarios** - Ensure critical features work without connection
3. **Monitor service worker updates** - Be aware of caching strategies
4. **Keep manifest up to date** - Update when branding changes
5. **Regular Lighthouse audits** - Maintain PWA best practices

## Resources

- [Next PWA Documentation](https://ducanh-next-pwa.vercel.app/)
- [Web.dev PWA Guide](https://web.dev/progressive-web-apps/)
- [MDN Web App Manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- [Workbox Documentation](https://developers.google.com/web/tools/workbox)

## Support Matrix

| Platform | Browser | Install Support | Offline Support |
|----------|---------|----------------|-----------------|
| iOS 16+  | Safari  | âœ… | âœ… |
| Android  | Chrome  | âœ… | âœ… |
| Windows  | Edge    | âœ… | âœ… |
| macOS    | Chrome  | âœ… | âœ… |
| Linux    | Chrome  | âœ… | âœ… |

